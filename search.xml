<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>技术书籍存档</title>
      <link href="/2025/12/07/%E6%8A%80%E6%9C%AF%E4%B9%A6%E7%B1%8D%E5%AD%98%E6%A1%A3/"/>
      <url>/2025/12/07/%E6%8A%80%E6%9C%AF%E4%B9%A6%E7%B1%8D%E5%AD%98%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<ul><li><p><a href="https://www.liberoscarcelli.com/">liberascarcelli</a></p><ul><li><p><a href="EmbeddedLinux.pdf" title="嵌入式Linux">Embedded Linux</a></p></li><li><p><a href="ReverseEngineeringForBegineers.pdf" title="逆向工程">Reverse Engineering</a></p></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>天马行空随心记</title>
      <link href="/2025/12/07/%E5%A4%A9%E9%A9%AC%E8%A1%8C%E7%A9%BA%E9%9A%8F%E5%BF%83%E8%AE%B0/"/>
      <url>/2025/12/07/%E5%A4%A9%E9%A9%AC%E8%A1%8C%E7%A9%BA%E9%9A%8F%E5%BF%83%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Static-link-warning-with-getaddrinfo"><a href="#Static-link-warning-with-getaddrinfo" class="headerlink" title="Static link warning with getaddrinfo"></a>Static link warning with <code>getaddrinfo</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Source - https://stackoverflow.com/q/2725255␍</span><br><span class="line">// Posted by Neeladri Vishweswaran, modified by community. See post <span class="string">&#x27;Timeline&#x27;</span> <span class="keyword">for</span> change <span class="built_in">history</span>␍</span><br><span class="line">// Retrieved 2025-12-07, License - CC BY-SA 4.0␍</span><br><span class="line">␍</span><br><span class="line">warning: Using <span class="string">&#x27;getaddrinfo&#x27;</span> <span class="keyword">in</span> statically linked applications requires at runtime the shared libraries from the glibc version used <span class="keyword">for</span> linking</span><br><span class="line"></span><br><span class="line">gcc -m32 -static -s -O2 -std=c99 -D_POSIX_C_SOURCE=200112L myprogram.c</span><br></pre></td></tr></table></figure><blockquote><p>glibc uses libnss to support a number of different providers for address resolution services. Unfortunately, you cannot statically link libnss, as exactly what providers it loads depends on the local system’s configuration.</p></blockquote><p>Maybe we can replace <code>glibc</code> with <code>musl-libc</code> to make everything work properly.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RISV交叉编译器安装</title>
      <link href="/2025/11/30/RISV%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%89%E8%A3%85/"/>
      <url>/2025/11/30/RISV%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Compile environment: Archlinux</p></blockquote><ul><li><a href="https://github.com/riscv-collab/riscv-gnu-toolchain">riscv-gnu-toolchain</a></li></ul><h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> pacman -Syu curl python3 libmpc mpfr gmp base-devel texinfo gperf patchutils bc zlib expat libslirp</span><br></pre></td></tr></table></figure><h2 id="Get-Source"><a href="#Get-Source" class="headerlink" title="Get Source"></a>Get Source</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/riscv/riscv-gnu-toolchain --depth 1</span><br><span class="line"><span class="comment"># update submodules</span></span><br><span class="line"><span class="comment"># ignore if you missing the `--depth -1` parameter</span></span><br><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure><h2 id="Compile-and-Installation"><a href="#Compile-and-Installation" class="headerlink" title="Compile and Installation"></a>Compile and Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=<span class="variable">$HOME</span>/opt/riscv</span><br><span class="line"><span class="comment"># glibc version</span></span><br><span class="line">make linux -j8</span><br><span class="line"><span class="comment"># muslc version</span></span><br><span class="line">make musl -j8</span><br></pre></td></tr></table></figure><blockquote><p>拆分任务数一定要量力而行，否则会把当前终端模拟器搞崩</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>初探Niri</title>
      <link href="/2025/11/23/%E5%88%9D%E6%8E%A2Niri/"/>
      <url>/2025/11/23/%E5%88%9D%E6%8E%A2Niri/</url>
      
        <content type="html"><![CDATA[<ul><li><p><a href="https://yalter.github.io/niri/">Niri-offical-wiki</a></p></li><li><p><a href="https://wiki.archlinux.org/title/Niri">Niri-arch-wiki</a></p></li><li><p><a href="https://wiki.archlinux.org/title/Greetd">greetd</a></p></li><li><p><a href="https://wiki.archlinux.org/title/Waybar">Waybar-arch-wiki</a></p></li><li><p><a href="https://github.com/Alexays/Waybar/wiki/Configuration">Waybar-official-wiki</a></p></li></ul><h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p><img src="/2025/11/23/%E5%88%9D%E6%8E%A2Niri/greeter.png" alt="greeter-screenshot"></p><p><img src="/2025/11/23/%E5%88%9D%E6%8E%A2Niri/niri-screenshot.png" alt="niri-screenshot"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>众所周知，Linux的桌面环境五花八门，例如GNOME，KDE，XFCE等等。这些桌面环境所呈现的窗口表现形式却可以简单归为两类。</p><ul><li><p>堆叠式窗口：最经典的一种，前面的窗口可以覆盖后面的窗口。</p></li><li><p>平铺式窗口：较为新奇的一种，所有窗口没有任何阻拦的平铺展现给用户。</p></li></ul><p><strong>堆叠式窗口</strong>我们日常在Windows上以及Linux的GNOME中都用了不少了，总是要用Alt + Tab 键进行切换。</p><p>尤其是在单屏的笔记本电脑上，这样的操作我不是很喜欢，因为有时候会忘记切换之前的内容，并且还要用鼠标进行窗口停靠操作，极大降低了效率。</p><p>我认为，电脑上所有的基本操作都可以只通过键盘来完成，鼠标用来check内容就行。</p><p>现在有种现代的桌面环境方案，wayland，基于其架构以及通信协议衍生出了多种<strong>合成器</strong>，如sway，hyprland以及今天我们要体验的niri。</p><p>基于Wayland的合成器基本采用了平铺式窗口排列方式并结合浮动的概念达到可控的堆叠式窗口排列。</p><h2 id="Niri"><a href="#Niri" class="headerlink" title="Niri"></a>Niri</h2><blockquote><p>Niri is a scrollable tiling Wayland compositor. Unlike Sway or Hyprland, Niri arranges the windows in an infinite horizontal desktop, where you can scroll to the left or to the right (although more advanced layouts are possible). It is similar to GNOME’s PaperWM and KDE’s Karousel. </p></blockquote><p>Niri是一个可滚动的平铺式Wayland合成器。与Sway和Hyprland不同的是，Niri将窗口编排在无限的可滚动的水平方向上。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> pacman -S niri rofi mako waybar xdg-desktop-portal-gtk xdg-desktop-portal-gnome kitty swaybg swayidle swaylock xwayland-satellite</span><br></pre></td></tr></table></figure><ul><li><p>niri: niri合成器本体，无需多言。</p></li><li><p>rofi: 比较好看的程序启动器，类似<code>utools</code>。</p></li><li><p>mako: 程序通知，会以弹窗方式提醒用户。</p></li><li><p>waybar：任务栏。</p></li><li><p>xdg-desktop-portal-gtk, xdg-desktop-portal-gnome: 用于屏幕分享。</p></li><li><p>kitty：一款终端模拟器。</p></li><li><p>swaybg: 桌面壁纸。</p></li><li><p>swayidle, swaylock：待机锁屏。</p></li><li><p>xwayland-satellite: X11程序兼容。</p></li></ul><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>Niri不仅可以使用显示管理器进行切换，也可以直接在终端执行<code>niri-session</code>启动。</p><p>Btw，还可以通过greetd实现自动登录，并且得到一个还不错的锁屏界面。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装greetd</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S greetd</span><br><span class="line"><span class="comment"># 安装sysc-greet</span></span><br><span class="line">yay -S sysc-greet</span><br><span class="line"><span class="comment"># 设置开启自启</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> greetd.service</span><br></pre></td></tr></table></figure><p><code>sysc-greet</code>是一个TUI的欢迎界面，非常Geek，是我的菜。</p><p><code>sysc-greet</code>的配置对<code>Niri</code>非常友好，基本不用额外配置（当然，对其他wayland合成器也友好hhhh），只需要配一下boot阶段要执行的命令即可。</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/greetd/config.toml</span></span><br><span class="line"><span class="section">[terminal]</span></span><br><span class="line"><span class="attr">vt</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="section">[default_session]</span></span><br><span class="line"><span class="comment"># Pick one:</span></span><br><span class="line"><span class="attr">command</span> = <span class="string">&quot;niri -c /etc/greetd/niri-greeter-config.kdl&quot;</span></span><br><span class="line"><span class="comment"># command = &quot;Hyprland -c /etc/greetd/hyprland-greeter-config.conf&quot;</span></span><br><span class="line"><span class="comment"># command = &quot;sway --unsupported-gpu -c /etc/greetd/sway-greeter-config&quot;</span></span><br><span class="line"><span class="attr">user</span> = <span class="string">&quot;greeter&quot;</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Niri就靠一个配置（~&#x2F;.config&#x2F;niri&#x2F;config.kdl）实现键盘映射、窗口布局等操作。</p><blockquote><p>Niri automatically applies the configuration when it’s saved. The live reload of invalid configuration won’t crash Niri; instead, the last working state is preserved, and the user is notified of the configuration error. niri validate can be invoked to validate the configuration outside of a Niri session. </p></blockquote><p>Niri在每次保存配置文件时会自动应用，热重载的，就算是错误配置也不会让Niri宕机，反手会给你一个错误配置的提示。</p><h4 id="任务栏"><a href="#任务栏" class="headerlink" title="任务栏"></a>任务栏</h4><p>任务栏采用<code>waybar</code>实现，其配置文件采用JSONC的格式，同时辅以CSS样式达到美化目的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S waybar</span><br></pre></td></tr></table></figure><p><code>waybar</code>的配置存储位置有多种，推荐的一个位置为<code>$HOME/.config/waybar</code>。</p><figure class="highlight jsonc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// My config</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;battery&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;bat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BAT0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;icon&#125;  &#123;capacity&#125;%&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-full&quot;</span><span class="punctuation">:</span> <span class="string">&quot;   &#123;capacity&#125;%&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-good&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;icon&#125;  &#123;capacity&#125;%&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">         <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;states&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;critical&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;full&quot;</span><span class="punctuation">:</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;good&quot;</span><span class="punctuation">:</span> <span class="number">98</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;normal&quot;</span><span class="punctuation">:</span> <span class="number">98</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;warning&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;clock&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;:%a %b %e  %R&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="number">30</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;top&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;modules-center&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;modules-left&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;niri/workspaces&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;niri/window&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;custom/media&quot;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;modules-right&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;network&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;temperature&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;battery&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;pulseaudio&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;clock&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;tray&quot;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format-disconnected&quot;</span><span class="punctuation">:</span> <span class="string">&quot;No Wifi&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-wifi&quot;</span><span class="punctuation">:</span> <span class="string">&quot;  Okay&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interface&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wlan0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="number">60</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;niri/window&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;max-length&quot;</span><span class="punctuation">:</span> <span class="number">150</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;niri/workspaces&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;disable-markup&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;disable-scroll&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;index&#125;&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;top&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;pulseaudio&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;icon&#125;  &#123;volume&#125;%&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;car&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;&quot;</span></span><br><span class="line">         <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;hands-free&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;headphone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;headset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;portable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-muted&quot;</span><span class="punctuation">:</span> <span class="string">&quot;   &#123;format_source&#125;&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;temperature&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;icon&#125; &#123;temperatureC&#125;°C&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format-icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">         <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;thermal-zone&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;tray&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;icon-size&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;spacing&quot;</span><span class="punctuation">:</span> <span class="number">15</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="背景壁纸"><a href="#背景壁纸" class="headerlink" title="背景壁纸"></a>背景壁纸</h4><h4 id="终端模拟器"><a href="#终端模拟器" class="headerlink" title="终端模拟器"></a>终端模拟器</h4><h4 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h4><h4 id="护眼模式"><a href="#护眼模式" class="headerlink" title="护眼模式"></a>护眼模式</h4><h4 id="中文输入法"><a href="#中文输入法" class="headerlink" title="中文输入法"></a>中文输入法</h4><h4 id="音视频适配"><a href="#音视频适配" class="headerlink" title="音视频适配"></a>音视频适配</h4><h4 id="待机锁屏"><a href="#待机锁屏" class="headerlink" title="待机锁屏"></a>待机锁屏</h4><h4 id="剪贴板"><a href="#剪贴板" class="headerlink" title="剪贴板"></a>剪贴板</h4><h4 id="截屏分享"><a href="#截屏分享" class="headerlink" title="截屏分享"></a>截屏分享</h4><h4 id="屏幕录制"><a href="#屏幕录制" class="headerlink" title="屏幕录制"></a>屏幕录制</h4><h4 id="窗口规则"><a href="#窗口规则" class="headerlink" title="窗口规则"></a>窗口规则</h4><h4 id="终端预览图片"><a href="#终端预览图片" class="headerlink" title="终端预览图片"></a>终端预览图片</h4><h4 id="弹窗通知"><a href="#弹窗通知" class="headerlink" title="弹窗通知"></a>弹窗通知</h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Wayland vs X11</title>
      <link href="/2025/11/21/Wayland-vs-X11/"/>
      <url>/2025/11/21/Wayland-vs-X11/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://wayland.freedesktop.org/">Wayland</a></li></ul><h2 id="Wayland介绍"><a href="#Wayland介绍" class="headerlink" title="Wayland介绍"></a>Wayland介绍</h2><blockquote><p>Wayland is a replacement for the X11 window system protocol and architecture with the aim to be easier to develop, extend, and maintain.</p></blockquote><p>如官网所述，其诞生是为了替换老的X11窗口协议，听起来还不错，所以Wayland也是一个窗口协议喽？。</p><blockquote><p>Wayland is the language (protocol) that applications can use to talk to a display server in order to make themselves visible and get input from the user (a person). A Wayland server is called a “compositor”. Applications are Wayland clients.</p></blockquote><p>所有的应用程序表现为Wayland客户端，通过Wayland协议与Wayland服务端通信，由Wayland服务端进行渲染并接收来自用户的输入（鼠标or键盘）反馈给前台应用程序。</p><blockquote><p>Wayland also refers to a system architecture. <strong>It is not just a server-client relationship between a compositor and applications.</strong> There is no single common Wayland server like Xorg is for X11, but every graphical environment brings with it one of many compositor implementations. Window management and the end user experience are often tied to the compositor rather than swappable components. </p></blockquote><p>Okay，也不完全是，准确来说是一个架构，统称为Wayland，其并非可以被视为由Wayland客户端、Wayland服务端以及通信的Wayland协议所组成的一般架构。</p><p>从描述来看，Wayland并不存在一个普适的服务端，几乎所有的图形环境都自带多种服务端的实现，并不容易被替换，往往取决于图形环境的实现。</p><blockquote><p>A core part of Wayland architecture is libwayland: an inter-process communication library that translates a protocol definition in XML to a C language API. This library does not implement Wayland, it merely encodes and decodes Wayland messages. The actual implementations are in the various compositor and application toolkit projects.</p></blockquote><p>这里描述的是一个底层C语言API库，用于将以XML格式包装的协议文件转换为外部可用的API接口，然后由各种应用程序以及Wayland服务器实现具体细节。</p><blockquote><p>Wayland does not restrict where and how it is used. A Wayland compositor could be a standalone display server running on Linux kernel modesetting and evdev input devices or on many other operating systems, or a nested compositor that itself is an X11 or Wayland application (client). Wayland can even be used in application-internal communication as is done in some web browsers. </p></blockquote><p>如此看来，Wayland的通信协议用的比较广泛，甚至在一些Web浏览器中被用作进程间通信协议。</p><p>这里介绍了三种应用场景：</p><ol><li><p>单一显示服务器。</p><p> 例如通过调用Linux的KMS来管理显示器，使用evdev读取用户输入事件，从而构成了你的桌面环境基础。</p></li><li><p>嵌套兼容角色。</p><p> 例如将其作为X11架构中的客户端角色，或者在一个Wayland合成器中表现为一个Wayland客户端，可以一直嵌套下去，他们之间通过<code>libwayland</code>通信。</p></li><li><p>进程间通信。</p><p> 例如在基于Chrome内核的浏览器中，Wayland被用于浏览器组件之间的通信框架。</p></li></ol><p>看来我们也可以基于<strong>libwayland</strong>开发一些有趣的东西了。</p><h2 id="Wayland架构"><a href="#Wayland架构" class="headerlink" title="Wayland架构"></a>Wayland架构</h2><blockquote><p>A good way to understand the wayland architecture and how it is different from X is to follow an event from the input device to the point where the change it affects appears on screen.</p></blockquote><p>Okay，让我们窥探下内部架构及原理。</p><p><img src="/2025/11/21/Wayland-vs-X11/x-architecture.png" alt="x-arch"></p><blockquote><p>The kernel gets an event from an input device and sends it to X through the evdev input driver. The kernel does all the hard work here by driving the device and translating the different device specific event protocols to the linux evdev input event standard.</p></blockquote><p>Okay，kernel率先通过驱动设备完成了很多硬核工作并提供了统一接口用于<code>X server</code>读取用户输入。</p><blockquote><p>The X server determines which window the event affects and sends it to the clients that have selected for the event in question on that window. The X server doesn’t actually know how to do this right, since the window location on screen is controlled by the compositor and may be transformed in a number of ways that the X server doesn’t understand (scaled down, rotated, wobbling, etc).</p></blockquote><p><code>X server</code>收到事件后会识别是哪个窗口的事件，然后将其发送给已经在该窗口订阅该事件的客户端，酷似一个封建大家长hhhh。</p><p>现代X11在引入合成器后，一切都变了。</p><p>引入合成器的目的是为了实现阴影、动画等一系列操作，<code>X server</code>并不像之前一样将窗口直接输出至屏幕上，而是使用缓冲区控制，交给合成器<strong>合成</strong>。</p><blockquote><p>The client looks at the event and decides what to do. Often the UI will have to change in response to the event - perhaps a check box was clicked or the pointer entered a button that must be highlighted. Thus the client sends a rendering request back to the X server.</p></blockquote><p><code>X client</code>收到来自<code>X server</code>的事件后决定应该显示什么，然后发回一个渲染请求给<code>X server</code>。</p><blockquote><p>When the X server receives the rendering request, it sends it to the driver to let it program the hardware to do the rendering. The X server also calculates the bounding region of the rendering, and sends that to the compositor as a damage event.</p></blockquote><p><code>X server</code>收到渲染请求后，将其发送给驱动让其做渲染。同时会做一些渲染区域的边界计算并将其作为一个<em>污染</em>事件发给合成器。</p><p>Btw，<em>污染</em>事件指示屏幕上有哪些像素区域需要被更新。</p><blockquote><p>The damage event tells the compositor that something changed in the window and that it has to recomposite the part of the screen where that window is visible. The compositor is responsible for rendering the entire screen contents based on its scenegraph and the contents of the X windows. Yet, it has to go through the X server to render this.</p></blockquote><p>合成器收到这个<em>污染</em>事件后根据其指示对屏幕内容进行重新组合。</p><p>合成器基于自身的场景地图以及来自<code>X windows</code>的内容进行重新渲染，然而实际的渲染还得交给<code>X server</code>来与显卡驱动沟通进行最终绘制。</p><blockquote><p>The X server receives the rendering requests from the compositor and either copies the compositor back buffer to the front buffer or does a pageflip. In the general case, the X server has to do this step so it can account for overlapping windows, which may require clipping and determine whether or not it can page flip. However, for a compositor, which is always fullscreen, this is another unnecessary context switch.</p></blockquote><p><code>X server</code>拿到来自合成器的渲染请求后还得自己处理一遍重叠窗口的裁剪计算，判定是否能够进行<strong>页面翻转操作</strong>。</p><p>然而合成器本来就合成输出的就是一张全屏图像，不存在任何重叠的情况，因此这里又多余了一步。</p><blockquote><p>As suggested above, there are a few problems with this approach. The X server doesn’t have the information to decide which window should receive the event, nor can it transform the screen coordinates to window-local coordinates. And even though X has handed responsibility for the final painting of the screen to the compositing manager, X still controls the front buffer and modesetting. Most of the complexity that the X server used to handle is now available in the kernel or self contained libraries (KMS, evdev, mesa, fontconfig, freetype, cairo, Qt, etc). In general, the X server is now just a middle man that introduces an extra step between applications and the compositor and an extra step between the compositor and the hardware. </p></blockquote><p>Okay，开始批判<code>X server</code>了。</p><ol><li><p><code>X server</code>无法决定事件该发给哪个窗口，也无法将屏幕坐标转换为窗口坐标。</p><p> 因为合成器做了一系列变换操作导致窗口坐标与屏幕完全对不上，<code>X server</code>拥有的旧场景地图根本无法支撑处理用户输入事件，最终决策还得交给合成器来完成。</p></li><li><p>尽管<code>X server</code>将屏幕的最终绘制权交给了合成器，但是它仍然控制着缓冲区以及内核模式设置，也就是说最终呈现还是<code>X server</code>在做。</p><p> 合成器将所有信息整合并输出为一整幅图像，明明掌握着确切的窗口信息以及像素信息，但最终的呈现还得交给<code>X server</code>再处理一遍进行缓冲区的交换或拷贝后再进行显示模式的设置等等操作。</p></li><li><p>尴尬的是，内核已经提供了<code>X server</code>所具有的一系列<em>复杂</em>的能力，总的来说，<code>X server</code>变成了一个小透明，中间人，在应用程序和合成器之间，在合成器和硬件之间引入了额外操作，造成了不必要的性能及资源损耗。</p></li></ol><blockquote><p>In wayland the compositor is the display server. We transfer the control of KMS and evdev to the compositor. The wayland protocol lets the compositor send the input events directly to the clients and lets the client send the damage event directly to the compositor: </p></blockquote><p><img src="/2025/11/21/Wayland-vs-X11/wayland-architecture.png" alt="wayland-arch"></p><p>Wayland将合成器作为背后一把手，将KMS以及evdev的控制权移交给合成器。</p><p>合成器将用户输入事件直接交给客户端或应用程序，客户端将<em>污染</em>事件直接返回给合成器进行最终的合成及绘制。</p><blockquote><p>The kernel gets an event and sends it to the compositor. This is similar to the X case, which is great, since we get to reuse all the input drivers in the kernel.</p></blockquote><p>合成器会接收来自内核的输入事件。</p><blockquote><p>The compositor looks through its scenegraph to determine which window should receive the event. The scenegraph corresponds to what’s on screen and the compositor understands the transformations that it may have applied to the elements in the scenegraph. Thus, the compositor can pick the right window and transform the screen coordinates to window-local coordinates, by applying the inverse transformations. The types of transformation that can be applied to a window is only restricted to what the compositor can do, as long as it can compute the inverse transformation for the input events.</p></blockquote><p>合成器查询它自己记录的场景地图，决定由那个窗口接收事件。</p><p>场景地图包含了屏幕上的内容以及坐标变换信息。</p><p>合成器选择正确的窗口进行屏幕坐标到窗口坐标的逆变换。</p><blockquote><p>As in the X case, when the client receives the event, it updates the UI in response. But in the wayland case, the rendering happens in the client, and the client just sends a request to the compositor to indicate the region that was updated.</p></blockquote><p>在<code>X</code>系统中，客户端接收到输入事件后在响应中更新界面。</p><p>在<code>Wayland</code>系统中，由客户端进行缓冲区渲染然后告知合成器那一块区域被更新了。</p><blockquote><p>The compositor collects damage requests from its clients and then recomposites the screen. The compositor can then directly issue an ioctl to schedule a pageflip with KMS.</p></blockquote><p>合成器收集来自客户端们的<em>污染</em>事件并重新组合屏幕。然后通过KMS使用<code>ioctl</code>调度<strong>页面翻转</strong>操作。</p><h2 id="Wayland-Rendering"><a href="#Wayland-Rendering" class="headerlink" title="Wayland Rendering"></a>Wayland Rendering</h2><blockquote><p>One of the details I left out in the above overview is how clients actually render under wayland. By removing the X server from the picture we also removed the mechanism by which X clients typically render. But there’s another mechanism that we’re already using with DRI2 under X: direct rendering. With direct rendering, the client and the server share a video memory buffer. The client links to a rendering library such as OpenGL that knows how to program the hardware and renders directly into the buffer. The compositor in turn can take the buffer and use it as a texture when it composites the desktop. After the initial setup, the client only needs to tell the compositor which buffer to use and when and where it has rendered new content into it. </p></blockquote><p>Wayland采用<strong>直接渲染</strong>的技术支撑客户端的渲染。</p><p>客户端与合成器共享一块video缓冲区，客户端链接的图形库，例如OpenGL知道如何操作这块缓冲区并渲染。</p><p>合成器随后将这块缓冲区作为一种<strong>贴图</strong>用于合成窗口，客户端操作这块缓冲区后只需要通知合成器哪块儿缓冲区被使用了以及何时，在缓冲区的哪个位置渲染了新内容以便于后续合成。</p><blockquote><p>This leaves an application with two ways to update its window contents:</p></blockquote><p>Okay，两种方式更新窗口内容？</p><blockquote><p>Render the new content into a new buffer and tell the compositor to use that instead of the old buffer. The application can allocate a new buffer every time it needs to update the window contents or it can keep two (or more) buffers around and cycle between them. The buffer management is entirely under application control.</p></blockquote><p>由应用程序将新内容写入新分配的缓冲区，然后告诉合成器别用老的缓冲区了，用新的。</p><p>新的缓冲区组织方式由应用程序自己控制。</p><blockquote><p>Render the new content into the buffer that it previously told the compositor to use. While it’s possible to just render directly into the buffer shared with the compositor, this might race with the compositor. What can happen is that repainting the window contents could be interrupted by the compositor repainting the desktop. If the application gets interrupted just after clearing the window but before rendering the contents, the compositor will texture from a blank buffer. The result is that the application window will flicker between a blank window or half-rendered content. The traditional way to avoid this is to render the new content into a back buffer and then copy from there into the compositor surface. The back buffer can be allocated on the fly and just big enough to hold the new content, or the application can keep a buffer around. Again, this is under application control.</p></blockquote><p>渲染新的内容到先前已告知合成器使用的缓冲区中，即共享缓冲区。</p><p>这种方式会与合成器产生竞争冲突，具体表现为应用程序的重绘可能会被合成器的桌面重绘中断。</p><p>如果应用程序在清空窗口内容后，但是在渲染新内容之前被中断，那么合成器得到的是一块空白缓冲区，结果就造成了应用窗口在空白界面和半渲染界面之前频繁闪烁。</p><p>传统解决该问题的办法是，应用程序将新内容渲染至<strong>后台缓冲区</strong>然后拷贝到合成器表面。</p><p>同样，后台缓冲区也需要应用程序自己控制分配和释放。</p><blockquote><p>In either case, the application must tell the compositor which area of the surface holds new contents. When the application renders directly to the shared buffer, the compositor needs to be noticed that there is new content. But also when exchanging buffers, the compositor doesn’t assume anything changed, and needs a request from the application before it will repaint the desktop. The idea that even if an application passes a new buffer to the compositor, only a small part of the buffer may be different, like a blinking cursor or a spinner. </p></blockquote><p>应用程序必须告知合成器哪块儿区域被更新为新内容了。</p><p>即便在交换缓冲区时，合成器也不会做任何重绘操作，必须收到应用程序的明确更新请求后才会重绘桌面。</p><p>这是因为即使交换了一整个缓冲区，但仅仅其中一小部分内容发生改变。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>我的第一台路由器</title>
      <link href="/2025/11/16/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
      <url>/2025/11/16/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><img src="/2025/11/16/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8/route-picture.jpg" alt="route-picture"></p><p>To be honest，这真的是我平生真正意义上的第一台路由器，小米AX3000T。</p><p>它是我从某<em>海鲜市场</em>以4碗牛肉小炒的价格淘来的，从Peking远道而来。这样的价格在比官网上出售的全新产品便宜大概40-50RMB，那这时候有人就要问了：唉，你为啥不买个全新的，就喜欢捡垃圾吃是吧？</p><p>实则不然。</p><p>首先，搞清楚自己的需求是什么。我是用来刷机当开发板用的，上面搞个OpenWrt系统，挂上clash，辅以自制机场，分流规则协同，一台真正的路由器诞生了。你可以无需任何Magic即可无感通达Wherever you want，简直是来去自如啊~（张伟声）</p><p>其次，官网的全新版本没BUG可利用。刷机分为线刷和网刷（自己起着玩儿的），线刷还得USB转TTL，通过SSH远程然后刷入简单多了，然而默认的SSH密码以及SSH使能开关并不是那么容易获取到的。好在已经有大佬利用了老固件版本的漏洞知晓了获取SSH密码以及开启SSH的方法。当然，新固件版本自然也可以通过官方救砖工具进行降级处理，然而，我实在太懒了，不想做这多余的一步，所以我在海鲜市场的招呼语统一为：<strong>你好，方便连上路由器电源进入管理后台看下固件版本信息吗？</strong>。</p><p><img src="chatting-picture.jpg" alt="chatting-picture" width="250" height="500"><br></p><p>我在海鲜市场一般是从个人卖家手里淘换，显然，大多数个人卖家要么是嫌麻烦，要么是技术小白，总之始终无法获取到我想要的关键信息。</p><p>BTW，二手贩子可能更加专业一点，但是我不敢保证他们没做什么手脚，所以坚定de选择个人卖家，至于怎么辨别，见仁见智，有时间出个经验贴。</p><p>经过我的不懈努力，终于有一位卖家甩了张截图过来，我一看，嗨呀，还是个全新固件版本，但是一想，刷了这么久，怎么就这么几个货色，算了，买来我自己降级ba。</p><p>说时迟，那时快。我点开付款界面，看到灰色的付款按钮眉头一皱，紧接着按下去，系统提示：有人已经拍下但暂未付款balabala。</p><p>Wtk，到手的鸭子飞了。。。。</p><p>山重水复疑无路，柳暗花明又一村。广撒网的好处来了，一位天使送来了她的截图，我一看，呵！还是v1满血版，不待她啰嗦，直接拍下付款一气呵成，只留下懵逼的卖家一脸懵逼。</p><p><img src="chatting-success.jpg" alt="chatting-success" width="250" height="500"><br></p><center>接下来，权且静静等待它的到来~</center><hr><p><img src="expressing.jpg" alt="expressing" width="250" height="500"><br></p><center>快递正在途中。</center><hr><p>苦心等待3天后，快递终于安全抵达。</p><p>接下来就可以开始折腾了。</p><h2 id="折腾"><a href="#折腾" class="headerlink" title="折腾"></a>折腾</h2><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>首先第一步是重置路由器，不必多言。</p><h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>使用网线将路由器与PC直连后手动设置IP与路由器同一网段，小米路由器的默认网段是<code>192.168.31.x/24</code>。</p><h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>破解小米路由器的SSH密码，这里借助一站式工具解决。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保Python版本&gt;=3.8并且有openssl库</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openwrt-xiaomi/xmir-patcher</span><br><span class="line"><span class="built_in">cd</span> xmir-patcher</span><br><span class="line">./run.sh</span><br></pre></td></tr></table></figure><p>根据提示项先设置路由器的IP，然后做全量备份，最后选择连接设备选项即可。</p><p>连接成功后选择永久保持SSH开启，因为后续要刷固件。</p><h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><p>下载合理的固件。一般来所选择openwrt，但是对中文不友好，使用immportalwrt对国内用户比较友好，当然，这仅仅是从使用上来说。</p><p>实际上，<code>immportalwrt</code>是<code>openwrt</code>的一个fork，文档啥的害得参考openwrt。</p><ul><li><p><a href="https://openwrt.org/inbox/toh/xiaomi/ax3000t?s%5B%5D=router">openwrt-xiaomi-ax3000t-wiki</a></p></li><li><p><a href="https://firmware-selector.immortalwrt.org/">immportalwrt-firmware-download</a></p></li></ul><p>选择相应的固件下载即可。</p><ul><li><p>SYSUPGRADE.itb: 永久更新系统固件，第一次进去的Immportalwrt是initramfs，驻留在内存的。</p></li><li><p>PRELOADER.bin: 结合UBOOT使用。</p></li><li><p>UBOOT.fip：UBOOT固件，即启动引导相关，配置得当可以搞好几个路由系统。</p></li><li><p>INITRAMFS-FACTORY.ubi：系统固件。</p></li></ul><p>下载到主机后通过<code>scp</code>工具将<code>SYSUPGRADE.itb</code>和<code>INITRAMFS-FACTORY.ubi</code>上传到路由器的<code>/tmp</code>目录，因为只有这个目录有权限且有空间访问。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># e.g. 破解后的密码一般是root</span></span><br><span class="line">scp SYSUPGRADE.itb INITRAMFS-FACTORY.ubi root@192.168.31.1:/tmp</span><br></pre></td></tr></table></figure><h3 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h3><p>SSH连接后刷写系统固件。</p><p>根据<a href="https://openwrt.org/inbox/toh/xiaomi/ax3000t?s%5B%5D=router#flash_instructions">官方WIKI</a>就行，从步骤3开始就可以，因为前几步已经通过一站式工具搞定了。</p><p>最后reboot就可以。</p><blockquote><p>Reboot后的路由器IP网段会变成<code>192.168.1.1</code></p></blockquote><h3 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h3><p>SSH连接后刷写UBOOT。</p><p>将<code>PRELOADER.bin</code>、<code>SYSUPGRADE.itb</code>和<code>UBOOT.fip</code>使用<code>scp</code>上传至路由器的<code>/tmp</code>目录，这里还要上传<code>SYSUPGRADE.itb</code>的原因是reboot后，tmp目录中的内容就不复存在了。</p><p>然后根据<a href="https://openwrt.org/inbox/toh/xiaomi/ax3000t?s%5B%5D=router#change_to_openwrt_u-boot">官网WIKI</a>操作重启也就OK了。</p><h3 id="Step-7"><a href="#Step-7" class="headerlink" title="Step 7"></a>Step 7</h3><p>配置Immortalwrt。</p><p>重启后访问<code>192.168.1.1</code>登入即可，此时是不需要任何密码的。</p><p>拿到新系统后就可以肆意妄为了。</p><p>你可以将光猫改成桥接模式，由你的路由器进行PPOE拨号，这样做的好处在于各司其职，不会造成任何一方的负载过高，优化你的网络体验。</p><blockquote><ol><li>访问光猫网关。</li><li>使用超级管理员账号密码登录。<br>  (username: telecomadmin password: Zrky@kEeAUHf)</li><li>修改上网配置从路由模式到桥接模式即可。</li></ol></blockquote><h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p><img src="/2025/11/16/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8/router-immportalwrt.png" alt="router-immportalwrt"></p><p>刷这个系统的主要一大优势是你可以自己下载软件包，持续优化你的上网体验，换句话说，这台路由器现在是你自己的了。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>不仅仅是路由器，后续提到的Niri和Wayland都是一样，只会让你感觉你自己是电脑的主人，是自己人生的主人，你可以持续优化获得新的体验，新的体验反过来激励你继续持续优化，完美闭环，isn’t it?</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
